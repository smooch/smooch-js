# v4.0.0

This major version introduces a new optimized initialization sequence which changes when key events like creating an appUser or establishing a websocket connection are happening. This new version also bring changes on how the Web Messenger is rendered in the page in order to minimize conflicts with the host page.

## What changed?

### Usage
#### Including the Web Messenger
The Web Messenger now uses a script loader to reduce its initial footprint and to allow the global variable to be available as soon as possible. This change doesn't apply to people using `npm` to include the Web Messenger.

#### Initializing the Web Messenger
Previously, the app token was used to identify the application used for the Web Messenger and was optional if the JWT authentication was used. This way of identifying the app is now deprecated and the app ID is now required at initialization time.

### Rendering
The Web Messenger is now run and rendered inside of an iframe in order to maximize compatibility with sites where it is used.

### CSS Customization
In order to maximize Javascript compatibility, the Web Messenger is now isolated in an `iframe`. Unfortunately, one side effect of this new way of rendering it makes previous CSS customization unusable since they can't target the inside of the `iframe`. Color customization is still available through the settings at `https://app.smooch.io` and strings can still be customized through `init()`.

### Behaviour changes
As part of this major update, the behaviour of the Web Messenger changed a bit.

#### `init()`
Since the Web Messenger is now loaded asynchronously using a script loader, only a subset of the public methods are available to use before `init()` is called. Those methods are `on`, `off`, `init`, and `destroy`. Once `init()` is successfully called, the library is considered fully initialized and all public methods are available to use.

#### `getConversation()`
A call to `getConversation()` would previously call the server and retrieve the conversation, making this function return a promise. With this update, `getConversation()` will return the local copy of the conversation synchronously. This method no longer returns a promise and returns the conversation object.

#### `render()`
This method no longer return the HTML node where the Web Messenger is mounted.

#### `getUserId()`
This method no longer exists, but has been replaced by `getUser()` which will return the whole user object. The ID should available at `user._id`.

#### `track()`
As the Whispers feature is being sunsetted, the `track()` method as been removed as it was only useful for that feature.

#### `getCore()`
As the Web Messenger no longer rely on `smooch-core` to talk to the API, `getCore()` has been removed.

#### Email capture
Email capture capability has been deprecated a while ago in favor of channel linking and was completely removed from the Web Messenger as part of this update.

### Bower and AMD
As part of this update, the Web Messenger will no longer be offering an AMD build and new versions won't be available on bower.
